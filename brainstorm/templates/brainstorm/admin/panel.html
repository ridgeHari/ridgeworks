{% extends 'layouts/base.html' %}
{% load i18n %}

{% block content %}
<div class="container">
  <h1 class="text-center">{% trans 'Admin Panel' %}</h1>

  <!-- Add Question Form -->
  <h2>{% trans 'Add Question' %}</h2>
  <div class="row">
    <div class="col-lg-6 col-md-8 col-sm-10 mx-auto">
      <form method="POST" action="{% url 'add_question' %}">
        {% csrf_token %}
        <div class="mb-3">
          <label for="question_title" class="form-label">{% trans 'Question Title' %}</label>
          <input type="text" class="form-control" id="question_title" name="question_title" placeholder="{% trans 'Question Title' %}" required>
        </div>
        <div class="mb-3">
          <label for="question_description" class="form-label">{% trans 'Question Description' %}</label>
          <textarea class="form-control" id="question_description" name="question_description" placeholder="{% trans 'Question Description' %}" required></textarea>
        </div>
        <button type="submit" class="btn btn-outline-primary d-block mx-auto">{% trans 'Add' %}</button>
      </form>
    </div>
  </div>

<!-- Question List -->
<h2>{% trans 'Question List' %}</h2>
<div class="row">
  {% for question in question_list %}
  <div class="col-lg-4 col-md-6 col-sm-12">
    <div class="card mb-4 position-relative" data-question-id="{{ question.0 }}">
      <div class="stamp position-absolute top-0 start-0 bg-primary text-white px-1 py-1 rounded-circle">
        {{ question.0 }}
      </div>
      <div class="card-body">
        <h5 class="card-title">{{ question.1 }}</h5>
        <p class="card-text">
          {% if question.2|length > 100 %}
            {{ question.2|truncatechars:100 }}
            <span id="questionMore{{ question.0 }}" class="d-none">{{ question.2|slice:":100" }}</span>
            <a href="#" class="card-link" onclick="toggleQuestionDescription({{ question.0 }}); return false;">{% trans 'Read More' %}</a>
          {% else %}
            {{ question.2 }}
          {% endif %}
        </p>
      </div>
      <div class="card-footer text-center">
        <a href="{% url 'edit_question' question.0 %}" class="btn btn-outline-primary me-2">
          <i class="fas fa-edit"></i> {% trans 'Edit' %}
        </a>
        <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ question.0 }}">
          <i class="fas fa-trash"></i> {% trans 'Delete' %}
        </button>
      </div>
    </div>
  </div>
  {% endfor %}
</div>


</div>

<script>
function toggleQuestionDescription(questionId) {
  const moreText = document.getElementById(`questionMore${questionId}`);
  const linkText = document.querySelector(`#questionMore${questionId} + .card-link`);

  if (moreText.classList.contains('d-none')) {
    moreText.classList.remove('d-none');
    linkText.textContent = '{% trans "Read Less" %}';
  } else {
    moreText.classList.add('d-none');
    linkText.textContent = '{% trans "Read More" %}';
  }
}
</script>
{% endblock %}
